#include "stdafx.h"
#include "MidiText.h"

#ifdef _DEBUG
#undef THIS_FILE
static char THIS_FILE[]=__FILE__;
#define new DEBUG_NEW
#endif

#include <stdio.h>

IMPLEMENT_DYNAMIC(CMidiTimeSignature, CMidiEvent)

//
////////////////////////////////////////////////////////////////////////
//		Set Time Signature
//
////////////////////////////////////////////////////////////////////////
CMidiTimeSignature::CMidiTimeSignature ( unsigned char cCommand, unsigned char *pBuffer )
{
	m_MidiEventStartOfBuffer	= pBuffer;

	m_cMidiEventCode			= MIDI_EVENT_CODE_META;
	m_cMidiEventSubCode			= MIDI_EVENT_CODE_META_TIMSIG_1;
	m_cMidiEventSubCode2		= MIDI_EVENT_CODE_META_TIMSIG_2;

	m_cMidiNN					= 0x00;
	m_cMidiDD					= 0x00;
	m_cMidiCC					= 0x00;
	m_cMidiBB					= 0x00;

	//		Set Event code
	m_cMidiEventCode			= cCommand;

	//	Set the Event Index.
	m_iEventIndex				= MIDI_EVENT_TIMESIG;

	pBuffer						+= 2;
	m_cMidiNN					= *pBuffer;
	pBuffer++;

	m_cMidiDD					= *pBuffer;
	pBuffer++;

	m_cMidiCC					= *pBuffer;
	pBuffer++;

	m_cMidiBB					= *pBuffer;
	pBuffer++;

	m_MidiEventEndOfBuffer		= pBuffer;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
CMidiTimeSignature::CMidiTimeSignature ( 
			unsigned char cVal1, unsigned char cVal2,
			unsigned char cVal3, unsigned char cVal4 )
{
	m_cMidiEventCode			= MIDI_EVENT_CODE_META;
	m_cMidiEventSubCode			= MIDI_EVENT_CODE_META_TIMSIG_1;
	m_cMidiEventSubCode2		= MIDI_EVENT_CODE_META_TIMSIG_2;

	m_cMidiNN					= cVal1;
	m_cMidiDD					= cVal2;
	m_cMidiCC					= cVal3;
	m_cMidiBB					= cVal4;

	//	Set the Event Index.
	m_iEventIndex				= MIDI_EVENT_TIMESIG;

}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
CMidiTimeSignature::~CMidiTimeSignature ()
{
	Free ();
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiTimeSignature::Save( FILE *hFile)
{
	if ( hFile != NULL )
	{
		fwrite ( &m_cMidiEventCode, 1, 1, hFile );
		fwrite ( &m_cMidiEventSubCode, 1, 1, hFile );
		fwrite ( &m_cMidiEventSubCode2, 1, 1, hFile );
		fwrite ( &m_cMidiNN, 1, 1, hFile );
		fwrite ( &m_cMidiDD, 1, 1, hFile );
		fwrite ( &m_cMidiCC, 1, 1, hFile );
		fwrite ( &m_cMidiBB, 1, 1, hFile );
	}
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
unsigned char CMidiTimeSignature::GetNN () const
{
	return ( m_cMidiNN );
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
unsigned char CMidiTimeSignature::GetDD () const
{
	return ( m_cMidiDD );
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
const unsigned char *CMidiTimeSignature::GetEventText() const
{
	return ( GetEventSmallText ( MIDI_EVENT_TIMESIG ) );
}

//
////////////////////////////////////////////////////////////////////////
void CMidiTimeSignature::Trace( FILE *hFile)
{
	if ( hFile != NULL )
	{
		fprintf ( hFile, 
			"%s - NN: %2d, DD: %2d, CC: %2d, BB: %2d\n", 
			GetEventSmallText ( MIDI_EVENT_TIMESIG ),
			m_cMidiNN, m_cMidiDD, m_cMidiCC, m_cMidiBB );
	}
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiTimeSignature::Free ()
{
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
unsigned char CMidiTimeSignature::GetEventValue1() const
{
	return m_cMidiNN;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
unsigned char CMidiTimeSignature::GetEventValue2() const
{
	return m_cMidiDD;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
unsigned char CMidiTimeSignature::GetEventValue3() const
{
	return m_cMidiCC;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
unsigned char CMidiTimeSignature::GetEventValue4() const
{
	return m_cMidiBB;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiTimeSignature::SetEventValue1(unsigned char  val)
{
	m_cMidiNN = val;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiTimeSignature::SetEventValue2(unsigned char  val)
{
	m_cMidiDD = val;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiTimeSignature::SetEventValue3(unsigned char  val)
{
	m_cMidiCC = val;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiTimeSignature::SetEventValue4(unsigned char  val)
{
	m_cMidiBB = val;
}

