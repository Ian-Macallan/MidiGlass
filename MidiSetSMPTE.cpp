#include "stdafx.h"
#include "MidiText.h"

#ifdef _DEBUG
#undef THIS_FILE
static char THIS_FILE[]=__FILE__;
#define new DEBUG_NEW
#endif

#include <stdio.h>

IMPLEMENT_DYNAMIC(CMidiSetSMPTE, CMidiEvent)

//
////////////////////////////////////////////////////////////////////////
//		Set SMPTE
//
////////////////////////////////////////////////////////////////////////
CMidiSetSMPTE::CMidiSetSMPTE ( unsigned char cCommand, unsigned char *pBuffer )
{
	m_MidiEventStartOfBuffer	= pBuffer;

	m_cMidiEventCode			= MIDI_EVENT_CODE_META;
	m_cMidiEventSubCode			= MIDI_EVENT_CODE_META_SMPTE_1;
	m_cMidiEventSubCode2		= MIDI_EVENT_CODE_META_SMPTE_2;

	m_cMidiHours				= 0x00;
	m_cMidiMinutes				= 0x00;
	m_cMidiSecondes				= 0x00;

	m_cMidiFractional			= 0x00;
	m_cMidiFrame				= 0x00;

	//		Set Event code
	if ( cCommand != m_cMidiEventCode )
	{
		EventMessageBox("CMidiSetSMPTE Code Differ");
	}

	//	Set the Event Index.
	m_iEventIndex				= MIDI_EVENT_SETSMPTE;

	pBuffer						+= 2;
	m_cMidiHours				= *pBuffer;
	pBuffer++;

	m_cMidiMinutes				= *pBuffer;
	pBuffer++;

	m_cMidiSecondes				= *pBuffer;
	pBuffer++;

	m_cMidiFractional			= *pBuffer;
	pBuffer++;

	m_cMidiFrame				= *pBuffer;
	pBuffer++;

	m_MidiEventEndOfBuffer		= pBuffer;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
CMidiSetSMPTE::CMidiSetSMPTE ( unsigned char cVal1, unsigned char cVal2,
							  unsigned char cVal3, unsigned char cVal4,
							  unsigned char cVal5 )
{
	m_cMidiEventCode			= MIDI_EVENT_CODE_META;
	m_cMidiEventSubCode			= MIDI_EVENT_CODE_META_SMPTE_1;
	m_cMidiEventSubCode2		= MIDI_EVENT_CODE_META_SMPTE_2;

	m_cMidiHours				= cVal1;
	m_cMidiMinutes				= cVal2;
	m_cMidiSecondes				= cVal3;

	m_cMidiFractional			= cVal4;
	m_cMidiFrame				= cVal5;

	//	Set the Event Index.
	m_iEventIndex				= MIDI_EVENT_SETSMPTE;

}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
CMidiSetSMPTE::~CMidiSetSMPTE ()
{
	Free ();
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiSetSMPTE::Save( FILE *hFile)
{
	if ( hFile != NULL )
	{
		fwrite ( &m_cMidiEventCode, 1, 1, hFile );
		fwrite ( &m_cMidiEventSubCode, 1, 1, hFile );
		fwrite ( &m_cMidiEventSubCode2, 1, 1, hFile );
		fwrite ( &m_cMidiHours, 1, 1, hFile );
		fwrite ( &m_cMidiMinutes, 1, 1, hFile );
		fwrite ( &m_cMidiSecondes, 1, 1, hFile );
		fwrite ( &m_cMidiFractional, 1, 1, hFile );
		fwrite ( &m_cMidiFrame, 1, 1, hFile );
	}
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
const unsigned char *CMidiSetSMPTE::GetEventText() const
{
	return ( GetEventSmallText ( MIDI_EVENT_SETSMPTE) );
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiSetSMPTE::Trace( FILE *hFile)
{
	if ( hFile != NULL )
	{
		fprintf ( hFile, "%s - H: %d, M: %d, S: %d, F: %d, %d\n",
			GetEventSmallText ( MIDI_EVENT_SETSMPTE) ,
			m_cMidiHours, m_cMidiMinutes, m_cMidiSecondes, 
			m_cMidiFractional, m_cMidiFrame );
	}
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiSetSMPTE::Free ()
{
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
unsigned char CMidiSetSMPTE::GetEventValue1() const
{
	return m_cMidiHours;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
unsigned char CMidiSetSMPTE::GetEventValue2() const
{
	return m_cMidiMinutes;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
unsigned char CMidiSetSMPTE::GetEventValue3() const
{
	return m_cMidiSecondes;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
unsigned char CMidiSetSMPTE::GetEventValue4() const
{
	return m_cMidiFractional;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
unsigned char CMidiSetSMPTE::GetEventValue5() const
{
	return m_cMidiFrame;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiSetSMPTE::SetEventValue1(unsigned char  val)
{
	m_cMidiHours = val;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiSetSMPTE::SetEventValue2(unsigned char  val)
{
	m_cMidiMinutes = val;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiSetSMPTE::SetEventValue3(unsigned char  val)
{
	m_cMidiSecondes = val;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiSetSMPTE::SetEventValue4(unsigned char  val)
{
	m_cMidiFractional = val;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiSetSMPTE::SetEventValue5(unsigned char  val)
{
	m_cMidiFrame = val;
}

