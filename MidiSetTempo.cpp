#include "stdafx.h"
#include "MidiText.h"

#ifdef _DEBUG
#undef THIS_FILE
static char THIS_FILE[]=__FILE__;
#define new DEBUG_NEW
#endif

#include <stdio.h>

IMPLEMENT_DYNAMIC(CMidiSetTempo, CMidiEvent)

//
////////////////////////////////////////////////////////////////////////
//		Set Tempo
//
////////////////////////////////////////////////////////////////////////
CMidiSetTempo::CMidiSetTempo( unsigned char cCommand, unsigned char *pBuffer )
{
	m_MidiEventStartOfBuffer	= pBuffer;

	m_cMidiEventCode			= MIDI_EVENT_CODE_META;
	m_cMidiEventSubCode			= MIDI_EVENT_CODE_META_TEMPO_1;
	m_cMidiEventSubCode2		= MIDI_EVENT_CODE_META_TEMPO_2;
	m_cMidiTempo [ 0 ]			= 0x00;
	m_cMidiTempo [ 1 ]			= 0x00;
	m_cMidiTempo [ 2 ]			= 0x00;

	//		Set Event code
	if ( cCommand != m_cMidiEventCode )
	{
		EventMessageBox("CMidiSetTempo Code Differ");
	}

	//	Set the Event Index.
	m_iEventIndex				= MIDI_EVENT_SETTEMPO;

	pBuffer						+= 2;
	m_cMidiTempo [ 0 ]			= *pBuffer;
	pBuffer++;

	m_cMidiTempo [ 1 ]			= *pBuffer;
	pBuffer++;

	m_cMidiTempo [ 2 ]			= *pBuffer;
	pBuffer++;

	m_MidiEventEndOfBuffer		= pBuffer;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
CMidiSetTempo::CMidiSetTempo( unsigned char cVal1, unsigned char cVal2,
							 unsigned char cVal3 )
{
	m_cMidiEventCode			= MIDI_EVENT_CODE_META;
	m_cMidiEventSubCode			= MIDI_EVENT_CODE_META_TEMPO_1;
	m_cMidiEventSubCode2		= MIDI_EVENT_CODE_META_TEMPO_2;
	m_cMidiTempo [ 0 ]			= cVal1;
	m_cMidiTempo [ 1 ]			= cVal2;
	m_cMidiTempo [ 2 ]			= cVal3;

	//	Set the Event Index.
	m_iEventIndex				= MIDI_EVENT_SETTEMPO;

	m_MidiEventEndOfBuffer		= NULL;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
CMidiSetTempo::~CMidiSetTempo()
{
	Free ();
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiSetTempo::Save( FILE *hFile)
{
	if ( hFile != NULL )
	{
		fwrite ( &m_cMidiEventCode, 1, 1, hFile );
		fwrite ( &m_cMidiEventSubCode, 1, 1, hFile );
		fwrite ( &m_cMidiEventSubCode2, 1, 1, hFile );
		fwrite ( &m_cMidiTempo, 1, 3, hFile );
	}
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
const unsigned char * CMidiSetTempo::GetTempo() const
{
	return m_cMidiTempo;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
const unsigned char *CMidiSetTempo::GetEventText() const
{
	return ( GetEventSmallText ( MIDI_EVENT_SETTEMPO ) );
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiSetTempo::Trace( FILE *hFile)
{
	if ( hFile != NULL )
	{
		fprintf ( hFile, "%s - Values: %3d, %3d, %3d\n", 
			GetEventSmallText ( MIDI_EVENT_SETTEMPO ),
			m_cMidiTempo [ 0 ], 
			m_cMidiTempo [ 1 ], 
			m_cMidiTempo [ 2 ] );
	}
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiSetTempo::Free()
{
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
unsigned char CMidiSetTempo::GetEventValue1() const
{
	return m_cMidiTempo [ 0 ];
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
unsigned char CMidiSetTempo::GetEventValue2() const
{
	return m_cMidiTempo [ 1 ];
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
unsigned char CMidiSetTempo::GetEventValue3() const
{
	return m_cMidiTempo [ 2 ];
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiSetTempo::SetEventValue1( unsigned char val )
{
	 m_cMidiTempo [ 0 ] = val;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiSetTempo::SetEventValue2( unsigned char val )
{
	 m_cMidiTempo [ 1 ] = val;
}

//
////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////
void CMidiSetTempo::SetEventValue3( unsigned char val )
{
	 m_cMidiTempo [ 2 ] = val;
}

